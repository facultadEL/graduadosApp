<!DOCTYPE html>
<html lang="es">
<head>
	<title>Perfil</title>
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
	<link type="text/css" rel="stylesheet" href="css/estilo.css"  media="screen,projection"/>
	<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"  media="screen,projection"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<script src="js/menu.js"></script>
<script>showSubNavBar('Contacto')</script>
<div class="container">
	<div class="card-panel blue lighten-5">
		<div class="row">
			<form class="col s12" id="form" onsubmit="return controlSubmit();">
                <h6 class="black-text">Envia tu consulta</h6>
				<div class="divider"></div>
				
				<div class="row">
					<div class="input-field col s12">
						<div class="form-group"> 
                            <input id="asunto" type="text" name="asunto" value="">
                            <label for="asunto">Asunto:</label><br><br>   
                        </div>
					</div>
				</div>
				<div class="row">
                    <form class="col s12">
                        <div class="input-field col s12">
                            <textarea id="textarea1" class="materialize-textarea"></textarea>
                            <label for="textarea1">Mensaje</label>
                        </div>
                    </form>
                </div>
                <h6 class="black-text">Mantente en contacto con nosotros!</h6>
				<div class="divider"></div>
				<div class="row">
					<div class="input-field col s12">
						<div class="form-group"> 
                            <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span>
  							<span>Av. Universidad 450 - Villa María, Córdoba</span>
                        </div>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<div class="form-group"> 
                            <span class="glyphicon glyphicon-phone-alt" aria-hidden="true"></span>
  							<span>0353-4537500 interno 124</span>
                        </div>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<div class="form-group"> 
                            <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
  							<span>http://graduados.frvm.utn.edu.ar/</span>
                        </div>
					</div>
				</div><div class="row">
					<div class="input-field col s12">
						<div class="form-group"> 
                            <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
  							<span>graduados@frvm.utn.edu.ar</span>
                        </div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="footer-copyright right-align">
	<div class="container">
		<i>© 2016 UTN FRVM</i>
	</div>
</div>

<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script type="text/javascript" src="js/functions.js"></script>
<script>
var habilitar = false;
var regional;

function activate(source)
{
	var htmlIcon = (source == 'edit') ? $('#iconEdit').html() : '';
	
	if(htmlIcon != 'done')
	{
		if(!habilitar)
		{
			$('#iconEdit').html('done');
			$('.fixed-action-btn').openFAB();
		}
		else
		{
			$('#iconEdit').html('mode_edit');
			$('.fixed-action-btn').closeFAB();
			getData();
		}
		habilitar = !habilitar;
		checkEnable();
	}
	else
	{
		if($('#cancelButton').css('opacity') == '0')
		{
			$('.fixed-action-btn').openFAB();
		}
		else
		{
			$('#form').submit();
		}
	}
}

function checkEnable()
{
	var disable = !habilitar;
	$('#first_name').prop('disabled',disable);
	$('#last_name').prop('disabled',disable);
	$('#dni').prop('disabled',disable);
	$('#fechanac').prop('disabled',disable);
	$('#autocompleteState').prop('disabled',disable);
	$('#email').prop('disabled',disable);
	$('#carCel').prop('disabled',disable);
	$('#cel').prop('disabled',disable);
	$('#carFijo').prop('disabled',disable);
	$('#fijo').prop('disabled',disable);
	$('#username').prop('disabled',disable);
	$('#password').prop('disabled',disable);
	$('#passwordRep').prop('disabled',disable);
}

function getData()
{
	var param = {
		"id":getItem('id')
	}
	
	$.ajax({
		type:"POST",
		data:param,
		url:"http://extension.frvm.utn.edu.ar/graduadosApi/getDataById.php",
		success: function(response)
		{
			successGetData(parse(response)[0]);
		},
		error: function(msg)
		{
			toasty('No se pudieron traer los datos','error');
		}
	});
}

function successGetData(data)
{
	if(data.primerLogin == 't')
	{
		passRequired = true;
		$('#password').prop('required',true);
	}
	else
	{
		passRequired = false;
		$('#password').prop('required',false);
	}

	$('#id').val(data.id);
	$('#first_name').val(data.nombre);
	$('#first_name').focus();
	$('#last_name').val(data.apellido);
	$('#last_name').focus();
	$('#dni').val(data.dni);
	$('#dni').focus();
	if(data.fechaNac != undefined)
	{
		var f = unformatDate(data.fechaNac);
		$('#fechanac').val(f);
	}
	$('#autocompleteState').val(data.localidad);
	$('#autocompleteState').focus();
	$('#regional').val(data.regionalNombre);
	$('#regional').focus();
	$('#regional').prop('disabled',true);
	$('#especialidad').val(data.especialidadNombre);
	$('#especialidad').focus();
	$('#especialidad').prop('disabled',true);
	$('#email').val(data.email);
	$('#email').focus();
	$('#celId').val(data.celId);
	$('#carCel').val(data.caracCel);
	$('#carCel').focus();
	$('#cel').val(data.cel);
	$('#cel').focus();
	$('#fijoId').val(data.fijoId);
	$('#carFijo').val(data.caracFijo);
	$('#carFijo').focus();
	$('#fijo').val(data.fijo);
	$('#fijo').focus();
	$('#username').val(data.username);
	$('#username').focus();
	$('#username').blur();
	$('#first_name').focus();
	checkEnable();
}
	
function controlSubmit()
{
	if(!habilitar) return false;
	var birthDate = formatDate($('#fechanac').val());

	var param = {
		"id":($('#id').val()),
		"nombre":($('#first_name').val()),
		"apellido":($('#last_name').val()),
		"dni":($('#dni').val()),
		"localidad":($('#loc').val()),
		"email":($('#email').val()),
		"caracCel":($('#carCel').val()),
		"cel":($('#cel').val()),
		"caracFijo":($('#carFijo').val()),
		"fijo":($('#fijo').val()),
		"username":($('#username').val()),
		"passRequired": passRequired,
		"password":($('#password').val()),
		"celId":($('#celId').val()),
		"fijoId":($('#fijoId').val()),
		"birthDate":birthDate,
		"localidadId":($('#idLocalidad').val()),
		"regional":($('#regional').val())
	}
	$('#loader').show();
	$.ajax({
		type:"POST",
		data: param,
		url: "http://extension.frvm.utn.edu.ar/graduadosApi/guardarDatos.php",
		success: function(response)
		{
			$('#loader').hide();
			var r = parse(response);
			if(r[0].success)
			{
				toasty('Datos guardados correctamente','success');
			}
			else
			{
				toasty("No se pudo guardar",'error');
			}
		},
		error: function(msg)
		{
			toasty("Hubo un error de conexion",'error');
		}
	});

	return false;
}

function sacarColor(me)
{
	$(me).css('box-shadow','0px 0px 0px 0px #ccc');
}

function getRegional()
{
	$.ajax({
		type:"POST",
		url:"http://extension.frvm.utn.edu.ar/graduadosApi/getRegional.php",
		success: function(response)
		{
			regional = parse(response);
		},
		error: function(msg)
		{
			toasty('Error al traer regionales','error');
		}
	});
}

function successGetRegional(data, val)
{
	if(data == undefined)
	{
		return;
	}
	
	val = (val == undefined) ? 0 : val;
	$('select').material_select('destroy');
	regional = data;
	htmlOptions = `<option value="0" disabled selected>Elija una regional</option>`;
	
	for(var i = 0; i < data.length; i++)
	{
		var id = data[i].id;
		var selected = (id == val) ? ' selected ' : '';
		htmlOptions += `<option value="${id}"${selected}>${data[i].nombre}</option>`;
	}
	
	$('#regional').html(htmlOptions);
	$('select').material_select();
}

$(document).ready(function (){
	$('#loader').hide();
	$(".button-collapse").sideNav();
	$('.datepicker').pickadate({
		selectMonths: true,
		selectYears: 100
	});
	getRegional();
	getData();
});
</script>
</body>
</html>