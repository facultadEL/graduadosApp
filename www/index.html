<!DOCTYPE html>
<html lang="es">
<head>
	<title>Login - Graduados FRVM</title>
	<!--Import Google Icon Font-->
	<!--<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
	<!--Import materialize.css-->
	<!--<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>-->
	<link type="text/css" rel="stylesheet" href="css/materialize.css"  media="screen,projection"/>
	<link type="text/css" rel="stylesheet" href="css/estilo.css"  media="screen,projection"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>
<div class="container-fluid">
	<div class="navbar-fixed">
		<nav>
			<div class="nav-wrapper nav-bar-fixed blue darken-4">
				<a href="#" class="brand-logo center">Inicio de Sesión</a>
			</div>
		</nav>
	</div>
</div>
<div class="container">
	<div class="preloader-wrapper active" id="loader">
    	<div class="spinner-layer spinner-blue-only">
			<div class="circle-clipper left">
				<div class="circle"></div>
			</div>
			<div class="gap-patch">
				<div class="circle"></div>
			</div>
			<div class="circle-clipper right">
				<div class="circle"></div>
			</div>
		</div>
	</div>
	<div class="card-panel blue lighten-5">
		<div class="center-align" >
			<img class="circle responsive-img" src="img/login.png" height="100" width="100">
		</div>
		<div class="row">
			<form class="col s12" action="#" onsubmit="return doLogin()">
				<div class="row">
					<div class="input-field col s12">
						<input id="username" type="text" placeholder="Introduce tu usuario">
						<label for="username">Usuario</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<input id="password" type="password" placeholder="Contraseña">
						<label for="password">Password</label>
					</div>
				</div>
				<div class="center-align">
					<button class="btn waves-effect light-blue darken-3" type="submit" name="action">Aceptar
						<i class="material-icons right">done</i>
					</button>
				</div>
				<div class="right-align">
					<a href="restauraPass.html">Restaurar contraseña</a>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="center-align" >
	<a href="registro.html">Crear una cuenta</a>
</div>

<div class="footer-copyright right-align">
    <div class="container">
        <i>© 2016 UTN FRVM</i>
    </div>
</div>

<!--Import jQuery before materialize.js-->
<!--<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>-->
<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script type="text/javascript" src="js/functions.js"></script>
<script>
	var f;

	function doLogin()
	{
		$('#loader').show();
		var user = $('#username').val();
		var pass = $('#password').val();

		var param = {
			"user":user,
			"pass":pass
		};

		$.ajax({
			type: "POST",
			url: "http://extension.frvm.utn.edu.ar/graduadosApi/login.php",
			data: param,
			success: function(response)
			{
				$('#loader').hide();
				var resp = JSON.parse(response);
				if(resp.length > 0)
				{
					if(resp[0].success)
					{
						//toasty('Ingreso correcto','success');
						//var t = this;
						//t.f = resp[0].first;
						//setTimeout(function()
						//{
							//if(t.f == 't')
							if(resp[0].first == 't')
							{
								window.location.href="registro.html";
							}
							else
							{
								var storage = window.localStorage;
								var id = resp[0].id;
								storage.setItem('id',id);
								window.location.href="inicio.html";
							}
						//}, 1000);
					}
				}
				else
				{
					toasty('Datos inválidos','error');
				}
			},
			error: function(msg)
			{
				alert(`Se ha producido un error en el logueo. Error: ${msg}`);
			}
		});

		return false;
	}

	$(document).ready(function(){
		$('#loader').hide();
		var storage = window.localStorage;
		var value = storage.getItem('id');
		if(value != undefined)
		{
			window.location.href = 'inicio.html';
		}
	});

	</script>
</body>
</html>