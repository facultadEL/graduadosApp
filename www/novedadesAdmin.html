<!DOCTYPE html>
<html lang="en">
<head>
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link type="text/css" rel="stylesheet" href="css/estilo.css"  media="screen,projection"/>
	<title>Graduados</title>
</head>
<body>
<script src="js/menu.js"></script>
<script>showSubNavBar('Novedades')</script>
<div class="container" id="bodyContainer">
	<div class="preloader-wrapper active" id="loader">
    	<div class="spinner-layer spinner-blue-only">
			<div class="circle-clipper left">
				<div class="circle"></div>
			</div>
			<div class="gap-patch">
				<div class="circle"></div>
			</div>
			<div class="circle-clipper right">
				<div class="circle"></div>
			</div>
		</div>
	</div>
    <div class="card-panel blue lighten-5">
        <div class="row">
            <form class="col s12" id="" onsubmit="">
                <div class="row">
                    <div class="input-field col s12 right-align">
                        <input type="checkbox" class="filled-in" id="novedad" checked="checked" onchange="checkNovedad()"/>
                        <label for="novedad">Novedad para todas las regionales</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="regional" onchange="enableCheckEsp()" disabled>
                        </select>
                        <label>Regional</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 right-align">
                        <input type="checkbox" class="filled-in" id="novedadEsp" checked="checked" onchange="checkNovedadEsp()" disabled/>
                        <label for="novedadEsp">Novedad para todas las especialidades</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="especialidad" disabled>

                        </select>
                        <label for="especialidad">Especialidad</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="tipo_novedad" disabled>
                            
                        </select>
                        <label for="tipo_novedad">Tipo Novedad</label>
                    </div>
                </div>
            </form>
        </div>

    </div>
    
</div>
<div class="footer-copyright right-align">
	<div class="container">
		<i>© 2016 UTN FRVM</i>
	</div>
</div>
<script src="cordova.js"></script>
<script src="js/index.js"></script>
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/materialize.min.js"></script>
<script src="js/functions.js"></script>
<script>
const l = new Loader();

function enableCheckEsp()
{
    $('#novedadEsp').prop('disabled','');
    getEspecialidad();
}

function checkNovedad()
{   
    if(($('#novedad').prop('checked')))
    {
         $('#regional').material_select('destroy');
         $('#regional').prop('disabled','disabled');
         $('#regional').prop('selectedIndex',0);
         $('#regional').material_select('');
    }
    
    if(!($('#novedad').prop('checked')))
    {   
        $('#regional').material_select('destroy');
        $('#regional').prop('disabled','');
        $('#regional').material_select('');
    }
}

function checkNovedadEsp()
{   
    if(($('#novedadEsp').prop('checked')))
    {
         $('#especialidad').material_select('destroy');
         $('#especialidad').prop('disabled','disabled');
         $('#especialidad').prop('selectedIndex',0);
         $('#especialidad').material_select('');
    }
    
    if(!($('#novedadEsp').prop('checked')))
    {  
        $('#especialidad').material_select('destroy');
        $('#especialidad').prop('disabled','');
        $('#especialidad').material_select('');
    }
}
    
function getRegional()
{
	$.ajax({
		type:"POST",
		url:"http://extension.frvm.utn.edu.ar/graduadosApi/getRegional.php",
		success: function(response)
		{
			successGetRegional(parse(response));
		},
		error: function(msg)
		{
			toasty('Error al traer regionales.Problema de conexión','error');
		}
	});
}

function successGetRegional(data, val)
{
	if(data == undefined)
	{
		return;
	}
	
	val = (val == undefined) ? 0 : val;
	$('select').material_select('destroy');
	regional = data;
	htmlOptions = `<option value="0" disabled selected>Elija una regional</option>`;
	
	for(var i = 0; i < data.length; i++)
	{
		var id = data[i].id;
		var selected = '';
		if(id == val)
		{
			selected = ' selected ';
		}
		htmlOptions += `<option value="${id}"${selected}>${data[i].nombre}</option>`;
	}
	
	$('#regional').html(htmlOptions);
	$('select').material_select();
}
function getEspecialidad()
{
    let param = {
		'regional':$('#regional').val()
	};
	$.ajax({
		type:"POST",
		url:"http://extension.frvm.utn.edu.ar/graduadosApi/getEspecialidad.php",
		data:param,
        success: function(response)
		{
			successGetEspecialidad(parse(response));
		},
		error: function(msg)
		{
			toasty('Error al traer especialidades.Problema de conexión','error');
		}
	});
}

function successGetEspecialidad(data,val)
{
	if(data == undefined)
	{
		return;
	}
	
	val = (val == undefined) ? 0 : val;
	$('select').material_select('destroy');
	especialidad = data;
	htmlOptions = `<option value="0" disabled selected>Elija una especialidad</option>`;
	
	for(var i = 0; i < data.length; i++)
	{
		var id = data[i].id;
		var selected = '';
		if(id == val)
		{
			selected = ' selected ';
		}
		htmlOptions += `<option value="${id}"${selected}>${data[i].nombre}</option>`;
	}
	
	$('#especialidad').html(htmlOptions);
	$('select').material_select();
}
$(document).ready(function()
{
    //checkNovedad();
    //checkNovedadEsp();
    getRegional();
	$(".button-collapse").sideNav();
    $('select').material_select();
    l.stop();
});
</script>
</body>
</html>