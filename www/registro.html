<!DOCTYPE html>
<html lang="es">
<head>
	<title>Registro</title>
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
	<link type="text/css" rel="stylesheet" href="css/estilo.css"  media="screen,projection"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script defer>

	var passRequired = false;

	function controlVacio(nombreSelector)
	{
		if($.trim($(nombreSelector).val()) == '')
		{
			$(nombreSelector).css('box-shadow','0px 0px 1px 1px #f24d4d');
			$(nombreSelector).focus();
			return false;
		}
		return true;
	}

	function sacarColor(me)
	{
		$(me).css('box-shadow','0px 0px 0px 0px #ccc');
	}

	function controlSubmit()
	{
		if(!controlVacio('#first_name')) return false;
		if(!controlVacio('#last_name')) return false;
		if(!controlVacio('#dni')) return false;
		if(!controlVacio('#loc')) return false;
		if(!controlVacio('#email')) return false;
		//if(!controlVacio('#cel')) return false;
		//if(!controlVacio('#fijo')) return false;
		if(!controlVacio('#username')) return false;
		if(passRequired)
		{
			if(!controlVacio('#password')) return false;
		}

		var param = {
			"id":($('#id').val()),
			"nombre":($('#first_name').val()),
			"apellido":($('#last_name').val()),
			"dni":($('#dni').val()),
			"localidad":($('#loc').val()),
			"email":($('#email').val()),
			"cel":($('#cel').val()),
			"fijo":($('#fijo').val()),
			"username":($('#username').val()),
			"passRequired": passRequired,
			"password":($('#password').val())
		}

		$.ajax({
			type:"POST",
			data: param,
			url: "http://extension.frvm.utn.edu.ar/graduadosApi/guardarDatos.php",
			success: function(response)
			{
				var r = JSON.parse(response);
				if(r[0].success)
				{
					alert("Guardado correctamente");
				}
				else
				{
					alert("No se pudo guardar");
				}
			},
			error: function(msg)
			{
				alert("Hubo un error al guardar los datos");
			}
		});

		return false;
	}

	function getDatos()
	{
		$.ajax({
			type:"GET",
			url:"http://extension.frvm.utn.edu.ar/graduadosApi/getDataById.php",
			success: function(response)
			{
				var r = JSON.parse(response);
				successGetDatos(r[0]);
			},
			error: function(msg)
			{
				alert(`Hubo un error al buscar los datos. Error: ${msg}`);
			}
		});
	}

	function successGetDatos(data)
	{
		if(data.primerLogin == 't')
		{
			passRequired = true;
			$('#password').prop('required',true);
		}

		$('#id').val(data.id);
		$('#first_name').val(data.nombre);
		$('#first_name').focus();
		$('#last_name').val(data.apellido);
		$('#last_name').focus();
		$('#dni').val(data.dni);
		$('#dni').focus();
		$('#loc').val(data.localidad);
		$('#loc').focus();
		$('#email').val(data.email);
		$('#email').focus();
		$('#cel').val('');
		$('#cel').focus();
		$('#fijo').val('');
		$('#fijo').focus();
		$('#username').val(data.username);
		$('#username').focus();
		$('#username').blur();
	}

	$(document).ready(function(){

	getDatos();

	});

	</script>
</head>
<body>


    <div class="container-fluid">
	    <div class="navbar-fixed">
	        <nav>
	            <div class="nav-wrapper nav-bar-fixed blue darken-4">
	                <a href="registro.html" class="brand-logo center">Registro</a>
	            </div>
	        </nav>
	    </div>
    </div>
    <div class="container">

        <div class="card-panel blue lighten-5">

            <div class="row">

                <form class="col s12" onsubmit="return controlSubmit();">

                    <h6 class="black-text">Datos personales</h6>
                    <div class="divider"></div>
                    <div class="row">
                        <div class="input-field col s6">
                        	<input type="hidden" id="id" />
                            <input id="first_name" type="text" onkeydown="sacarColor(this)">
                            <label for="first_name">Nombre</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="last_name" type="text" onkeydown="sacarColor(this)">
                            <label for="last_name">Apellido</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="dni" type="number" onkeydown="sacarColor(this)">
                            <label for="dni">DNI</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="loc" type="text" onkeydown="sacarColor(this)">
                            <label for="loc">Localidad</label>
                        </div>
                    </div>

                    <h6 class="black-text">Contacto</h6>
                    <div class="divider"></div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="email" type="email" onkeydown="sacarColor(this)">
                            <label for="email">Correo</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="cel" type="text" onkeydown="sacarColor(this)">
                            <label for="cel">Celular</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="fijo" type="text" onkeydown="sacarColor(this)">
                            <label for="cel">Telefono fijo</label>
                        </div>
                    </div>

                    <h6 class="black-text">Datos de cuenta</h6>
                    <div class="divider"></div>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="username" type="text" onkeydown="sacarColor(this)">
                            <label for="username">Nombre Usuario</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="password" type="password" onkeydown="sacarColor(this)" pattern=".{6,}">
                            <label for="password">Contraseña</label>
                        </div>
                    </div>

                    <div class="center-align">
                        <button class="btn waves-effect light-blue darken-3" type="submit" name="action">Registrarme
                            <i class="material-icons right">done</i>
                        </button>
                    </div>
                </form>
            </div>

        </div>
        <div class="footer-copyright right-align">
            <div class="container">
                <i>© 2016 UTN FRVM</i>
            </div>
        </div>
    </div>


    <!--Import jQuery before materialize.js-->
    
    <script type="text/javascript" src="js/materialize.min.js"></script>
</body>
</html>